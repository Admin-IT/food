<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>有谱 - 美食,菜谱</title>
    <link rel="shortcut icon" href="img/png/logo1.png" type="image/x-icon">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/my.css">
    <script src="js/jquery-1.12.4.min.js"></script>
</head>
<body>
<div class="login_main">
    <div class="login_nav">
        <div class="login_navw">
            <a href="" class="logo"></a>
            <ul>
                <li>
                    <a href="">首页</a>
                </li>
                <li>
                    <a href="">菜谱大全</a>
                </li>
                <li>
                    <a href="">饮食健康</a>
                </li>
                <li>
                    <a href="">美食菜单</a>
                </li>
                <li>
                    <a href="">美食达人</a>
                </li>
                <li>
                    <a href="">美食视频</a>
                </li>
                <li>
                    <a href="">产品下载</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="login_title">欢迎来到“有谱”</div>
    <div class="new_loginpage">

        <div class="n1_loginbox_w" id="msj_loginbox">
            <script type="text/javascript">
                $(function(){
                    $(".login_false_tip").hide();
                    $("#n1_loginbox_w_w").removeClass("right").addClass("left");
                    $(this).siblings().removeClass("current");
                    $(this).addClass("current");
                    $("#login_phone_tab").click(function(){
                        $(".login_false_tip").hide();
                        $("#n1_loginbox_w_w").removeClass("right").addClass("left");
                        $(this).siblings().removeClass("current");
                        $(this).addClass("current");
                    });
                    $("#login_acc_tab").click(function(){
                        $(".login_false_tip").hide();
                        $("#n1_loginbox_w_w").removeClass("left").addClass("right");
                        $(this).siblings().removeClass("current");
                        $(this).addClass("current");
                    });
                });
            </script>
            <!--    选择账号登录方式        -->
            <div class="loginbox_title">
                <a href="javascript:;"  id="login_phone_tab" class="current">手机号登录</a>
                　|　
                <a href="javascript:;" id="login_acc_tab" class="">账号密码登录</a>
            </div>
            <div class="n1_loginbox_w_w left" id="n1_loginbox_w_w">
                <div class="n1_loginbox_w1" id="n1_loginbox_w1">
                    <form >
                        <div class="n1_loginitem">
                            <input id="login_mobile" type="text" name="username" class="text" placeholder="请输入手机号">
                        </div>
                        <div class="n1_loginitem">
                            <input type="hidden" name="login_type" value="1">
                            <input id="login_code" type="text" class="text forcheck pyzm_forcheck yzm" name="password" placeholder="请输入验证码">
                            <a href="javascript:void(0)" class="phone_yzmbtn" id="phone_yzmbtn">获取验证码</a>
                        </div>
                        <div class="n1_loginitem" style="height: 20px;line-height: 20px;">
                            <label class="label2">
                                <input type="checkbox" checked="checked" class="checkbox" name="cookietime">
                                记住账号&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <a href="" class="forgetpassword1">忘记密码?</a>
                            </label>
                        </div>
                        <div class="n1_loginitem" style="text-align: center;">
                            <input type="submit" class="submit" value="登 录">
                        </div>
                    </form>
                </div>
                <div class="n1_loginbox_w2" id="n1_loginbox_w2">
                    <form>
                        <div class="n1_loginitem">
                            <input  type="text" name="username" class="text" placeholder="请输入账号">
                        </div>
                        <div class="n1_loginitem">
                            <input type="hidden" name="login_type" value="2">
                            <input type="text" class="password" name="password" placeholder="请输入密码">
                        </div>
                        <div class="n1_loginitem" style="height: 20px;line-height: 20px;">
                            <label class="label2">
                                <input type="checkbox" checked="checked" class="checkbox" name="cookietime">
                                "记住账号    "
                                <a href="" class="forgetpassword1">忘记密码?</a>
                            </label>
                        </div>
                        <div class="n1_loginitem" style="text-align: center;">
                            <input type="submit" class="submit" value="登 录">
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="n1_more_zc" id="nl_more_zc" style="display: none;">
            <div class="n1_loginbox_www">
                <div class="n1_login_ww">
                    <div class="loginbox_title">
                        <span class="current">注册“有谱”</span>
                    </div>
                    <div class="n1_loginbox_w" style="float: left;">
                        <form class="register_form_pn" action="" method="post" id="reg_form">
                            <input type="hidden" name="ac" value="zhuce">
                            <div class="n1_loginitem">
                                <input type="text" name="reg_phone" class="text forcheck pn_forcheck" passcheck="0" id="reg_phone" placeholder="请输入邮箱">
                            </div>
                            <div class="login_tips tip" style="display: none;"> </div>
                            <div class="n1_loginitem">
                                <input type="text" name="reg_code" id="reg_code" class="text forcheck pyzm_forcheck1 yzm" passeheck="0" placeholder="请输入验证码">
                                <a href="javascript:void(0)" class="phone_yzmbtn" id="phone_yzmbtn1">获取验证码</a>
                            </div>
                            <div class="login_tips false" style="display: none;"> </div>
                            <div class="n1_loginitem" style="text-align: center;">
                                <input type="submit" class="submit register_submit" id="reg_btn" value="注册">
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <a href="javascript:void(0)" class="golink" id="nl_gozc" opened="1">没有账号？立即注册</a>
    </div>
</div>
<div class="blackbg" id="yzm_blackbg"></div>
<script>
    var yzmsti;
    var yzmsti1;
    var type = "";

    if(type=='zhuce'){
        $("#nl_more_zc").slideDown();
        $(this).html("已有账号？立即登录");
        $(this).attr("opened","1");
        $("#msj_loginbox").slideUp();
    }

    function showYZM(){
        $("#yzm_blackbg").fadeIn();
        $("#yzm_yzmbox").fadeIn();
    }

    function doPyzmNext(){
        var _this = $("#phone_yzmbtn1");
        _this.addClass("sended");
        _this.html("60秒后重新获取");
        var i = 59;
        yzmsti1  = setInterval(function(){
            _this.html(i+"秒后重新获取");
            if(i == 0){
                clearInterval(yzmsti1);
                _this.removeClass("sended");
                _this.html("获取验证码");
            }
            i--;
        },1000);
    }

    function doPyzmNext2(){
        var _this = $("#phone_yzmbtn");
        _this.addClass("sended");
        _this.html("60秒后重新获取");
        var i = 59;
        yzmsti1  = setInterval(function(){
            _this.html(i+"秒后重新获取");
            if(i == 0){
                clearInterval(yzmsti1);
                _this.removeClass("sended");
                _this.html("获取验证码");
            }
            i--;
        },1000);
    }

    $(function(){
        $("#yzm_blackbg").click(function(){
            $("#yzm_blackbg").fadeOut();
            $("#yzm_yzmbox").fadeOut();
        });

        $("#yzmbox_yzmimg").click(function(){
            var _this = $(this);
            var verify_code_key = $('#verifycode_key_mobile').val();
            var url = 'https://i.meishi.cc/ajax/verfiy_img.php?verifycode_key=';
            url = url + verify_code_key + '&rand=' + (new Date()).getTime();
            _this.attr("src",url)
        });

        $("#yzmbox_yzmbtn").click(function(){
            var _this = $(this);
            var mobile_login = $('#login_mobile').val();
            if(!mobile_login){
                var mobile = $('#reg_phone').val();
                var login_type="2";
                var type=2;
            }else{
                var mobile = $('#login_mobile').val();
                var login_type="1";
                var type=6;
            }
            var verify_code_key = $('#verifycode_key_mobile').val();
            var yzm_mobile = $('#yzm_mobile').val();
            $.post("/send_mobile_code.php", {"mobile":mobile,"verifycode":yzm_mobile,"verifycode_key":verify_code_key,"type":type},function(data){
                var obj = eval('(' + data + ')');
                if(obj.code=='1'){
                    $("#yzm_blackbg").fadeOut();
                    $("#yzm_yzmbox").fadeOut();
                    if(login_type==1){
                        doPyzmNext2();
                    }else{
                        doPyzmNext();
                    }

                }else{
                    alert("验证码错误，请重新输入");
                }

            })
        });

        $("#phone_yzmbtn").click(function(){
            var _this = $(this);
            if(_this.hasClass("sended")){

            }else{
                showYZM();
            }
        });

        $("#phone_yzmbtn1").click(function(){
            var _this = $(this);
            var mobile = $('#reg_phone').val();
            if(_this.hasClass("sended")){
            }else{
                showYZM();
            }
        });

        $("#nl_gozc").click(function(){
            if($(this).attr("opened") == 0){
                $("#nl_more_zc").slideDown();
                $(this).html("已有账号？立即登录");
                $(this).attr("opened","1");
                $("#msj_loginbox").slideUp();
            }else{
                $("#nl_more_zc").slideUp();
                $(this).html("没有账号？立即注册");
                $(this).attr("opened","0");
                $("#msj_loginbox").slideDown();
            }
        });

        $(".pn_forcheck").keyup(function(){
            var val = $(this).val();
            $(this).parent().next().show();
            if(checkPhonenum(val)){
                $(this).parent().next().removeClass().addClass("login_tips true");
                $(this).parent().next().html("手机号码格式正确");
                $(this).attr("passCheck","1");
            }else{
                $(this).parent().next().removeClass().addClass("login_tips tip");
                $(this).parent().next().html("请输入正确的手机号码");
                $(this).attr("passCheck","0");
            }

        });

        $(".pn_forcheck").blur(function(){
            var val = $(this).val();
            $(this).parent().next().show();
            if(checkPhonenum(val)){
                $(this).parent().next().removeClass().addClass("login_tips true");
                $(this).parent().next().html("手机号码格式正确");
                $(this).attr("passCheck","1");
            }else{
                $(this).parent().next().removeClass().addClass("login_tips false");
                $(this).parent().next().html("请输入正确的手机号码");
                $(this).attr("passCheck","0");
            }
        });

        //验证登陆
        $(".pyzm_forcheck").blur(function(){
            var _this = $(this);
            var mobile = $('#login_mobile').val();
            var code =$('#login_code').val();
            $.post("/yz_mobile_code.php",{
                'mobile': mobile,
                'type': 6,
                'code': code
            },function(data){
                var obj = eval('(' + data + ')');
                if(obj.code == 1){
                    _this.parent().next().removeClass().addClass("login_tips true");
                    _this.parent().next().html("验证码正确");
                    _this.attr("passCheck","1");
                    _this.parent().next().show();
                }else{
                    _this.parent().next().removeClass().addClass("login_tips false");
                    _this.parent().next().html("验证码错误");
                    _this.attr("passCheck","0");
                    _this.parent().next().show();
                }
            });
        });

        //验证注册
        $(".pyzm_forcheck1").blur(function(){
            var _this = $(this);
            var mobile = $('#reg_phone').val();
            var code =$('#reg_code').val();
            $.post("/yz_mobile_code.php",{
                'mobile': mobile,
                'type': 2,
                'code': code
            },function(data){
                var obj = eval('(' + data + ')');
                if(obj.code == 1){
                    _this.parent().next().removeClass().addClass("login_tips true");
                    _this.parent().next().html("验证码正确");
                    _this.attr("passCheck","1");
                    _this.parent().next().show();
                }else{
                    _this.parent().next().removeClass().addClass("login_tips false");
                    _this.parent().next().html("验证码错误");
                    _this.attr("passCheck","0");
                    _this.parent().next().show();
                }
            });
        });

        $(".email_forcheck").keyup(function(){
            var val = $(this).val();
            $(this).parent().next().show();
            if(checkEmail(val)){
                $(this).parent().next().removeClass().addClass("login_tips true");
                $(this).parent().next().html("邮箱格式正确");
                $(this).attr("passCheck","1");
            }else{
                $(this).parent().next().removeClass().addClass("login_tips tip");
                $(this).parent().next().html("请输入正确的邮箱");
                $(this).attr("passCheck","0");
            }
        });

        $(".email_forcheck").blur(function(){
            var val = $(this).val();
            $(this).parent().next().show();
            if(checkEmail(val)){
                $(this).parent().next().removeClass().addClass("login_tips true");
                $(this).parent().next().html("邮箱格式正确");
                $(this).attr("passCheck","1");
            }else{
                $(this).parent().next().removeClass().addClass("login_tips false");
                $(this).parent().next().html("请输入正确的邮箱");
                $(this).attr("passCheck","0");
            }
        });

        $(".pw_forcheck").keyup(function(){
            var val = $(this).val();
            if(val.length < 5){
                $(this).parent().next().show();
                $(this).parent().next().next().hide();
                $(this).parent().next().removeClass().addClass("login_tips false");
                $(this).parent().next().html("密码的长度应为6-16位");
                $(this).attr("passCheck","0");
            }else if(val.length > 15){
                $(this).parent().next().show();
                $(this).parent().next().next().hide();
                $(this).parent().next().removeClass().addClass("login_tips false");
                $(this).parent().next().html("密码的长度应为6-16位");
                $(this).attr("passCheck","0");
            }else{
                $(this).parent().next().hide();
                $(this).parent().next().next().show();
                var pwcheckele = $(this).parent().next().next();
                var x = checkPw(val);
                if(x == 1){
                    pwcheckele.removeClass().addClass("login_pw_tips state1");
                    pwcheckele.html("密码强度：弱");
                }else if(x == 2){
                    pwcheckele.removeClass().addClass("login_pw_tips state2");
                    pwcheckele.html("密码强度：中");
                }else if(x == 3){
                    pwcheckele.removeClass().addClass("login_pw_tips state3");
                    pwcheckele.html("密码强度：强");
                }else{}
                $(this).attr("passCheck","1");
            }
        });

        $(".register_submit").click(function(e){
            var f = submitCheck($(this));
            if(f == 1){
                $(this).parents("form").sibmit();
            }else{
                alert("资料填写错误，请写相关代码");
                e.preventDefault();
            }
        });

        $("#reg_but").click(function(){
            var _this = $(this);
            var re_box = $('#xianyi').val();
            if(re_box==0){
                _this.parent().prev().removeClass().addClass("login_tips false");
                _this.parent().prev().html("验证码正确");
                _this.parent().prev().show();
                return false;
            }
            $('#reg_form').submit();
        });
    });

    function checkPhonenum(string){
        var reg = /^0?1[3|4|5|8|7][0-9]\d{8}$/;
        return reg.test(string);
    }

    function checkEmail(string){
        var reg = /^([\.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/;;
        return reg.test(string);
    }

    function checkPw(string){
        var color,Wcolor,Scolor,Color_Html;
        var m=0;
        var Modes=0;
        if(string.length<=4){m=1;}
        if(string.length<=0){m=0;}

        for(i=0; i<string.length; i++){
            var charType=0;
            var t=string.charCodeAt(i);
            if(t>=48 && t <=57){charType=1;}
            else if(t>=65 && t <=90){charType=2;}
            else if(t>=97 && t <=122){charType=4;}
            else{charType=4;}
            Modes |= charType;
        }
        for(i=0;i<4;i++){
            if(Modes & 1){m++;}
            Modes>>>=1;
        }
        return(m);
    }

    function submitCheck(ele){
        var f = ele.parents("form");
        if(f.hasClass("register_form_pn")){
            var e = $(".register_form_pn .forcheck");
        }else if(f.hasClass("register_form_email")){
            var e = $(".register_form_email .forcheck");
        }

        var arr = [];
        $.each(e,function(){
            arr.push($(this).attr("passCheck"));
        });
        if($.inArray("0", arr) == -1){
            return 1;
        }else{
            return 0;
        }

    }

</script>
</body>

</html>